var through = require('through2');
var template = require('../template');
var scheme = require('../scheme');

function transform(data, enc, callback) {
  var res = {
    fileName: data.fileName,
    meta: data.meta,
    content: template.applyTemplate(
        data.sheet,
        scheme.createScheme(data.sheet),
        data.fileName),
  };

  this.push(res);
  callback();
};

if (process.env.NODE_ENV === 'testing') {
  module.exports = transform;
} else {
  module.exports = through.obj(transform);
};
