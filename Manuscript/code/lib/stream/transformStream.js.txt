var through = require('through2');
var template = require('../template');
var scheme = require('../scheme');

function transform(data, enc, callback) {
  var generalScheme = scheme.scheme.createScheme(data.sheet);
  var orderScheme = scheme.order.makeOrder(data.sheet, generalScheme);
  var executionScheme = scheme.executionScheme.create(generalScheme, orderScheme);
  var res = {
    fileName: data.fileName,
    meta: data.meta,
    content: template.applyTemplate(
        data.sheet,
        executionScheme,
        data.fileName),
  };

  this.push(res);
  callback();
};
